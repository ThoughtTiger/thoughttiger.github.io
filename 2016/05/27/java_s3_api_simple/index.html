<!DOCTYPE html>
<html lang="zh-CN">
<head>
  
    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

  <meta charset="utf-8">
  
  <title>Java开发Amazon S3 API | Thought_Tiger`s Blogs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="eclipse插件">
<meta property="og:type" content="article">
<meta property="og:title" content="Java开发Amazon S3 API">
<meta property="og:url" content="http://thoughttiger.github.com/2016/05/27/java_s3_api_simple/index.html">
<meta property="og:site_name" content="Thought_Tiger`s Blogs">
<meta property="og:description" content="eclipse插件">
<meta property="og:image" content="http://i.imgur.com/Oa6XkV4.jpg">
<meta property="og:image" content="http://i.imgur.com/9nXDZhr.jpg">
<meta property="og:image" content="http://i.imgur.com/azLYiA3.jpg">
<meta property="og:image" content="http://i.imgur.com/erTdeMZ.jpg">
<meta property="og:image" content="http://i.imgur.com/VAYcqin.jpg">
<meta property="og:image" content="http://i.imgur.com/JOX0z6K.jpg">
<meta property="og:image" content="http://i.imgur.com/1YwvcMC.jpg">
<meta property="og:image" content="http://i.imgur.com/YurwzE2.jpg">
<meta property="og:updated_time" content="2016-05-26T16:17:36.015Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Java开发Amazon S3 API">
<meta name="twitter:description" content="eclipse插件">
<meta name="twitter:image" content="http://i.imgur.com/Oa6XkV4.jpg">
  
    <link rel="alternative" href="/atom.xml" title="Thought_Tiger`s Blogs" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
      <link href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css" rel="stylesheet">
  
  
  
      <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
      <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">
  
  <link rel="stylesheet" href="/css/style.css">
  
  <link href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  
  
      <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">
  
  <script src="//cdn.bootcss.com/jquery/1.9.1/jquery.min.js"></script>
  <script src="//cdn.bootcss.com/clipboard.js/1.5.9/clipboard.min.js"></script>
  <script>
      var yiliaConfig = {
          fancybox: true,
          animate: true,
          isHome: false,
          isPost: true,
          isArchive: false,
          isTag: false,
          isCategory: false,
          open_in_new: false,
          fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
          scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.0.9/scrollreveal.min.js",
          search: undefined
      }
  </script>

  
      <script>
          yiliaConfig.rootUrl = "/";
      </script>
  

  
  
      <script>
          var _hmt = _hmt || [];
          (function() {
              var hm = document.createElement("script");
              hm.src = "//hm.baidu.com/hm.js?9bd71d3ec62adcf2e47932ad4a45cf52";
              var s = document.getElementsByTagName("script")[0]; 
              s.parentNode.insertBefore(hm, s);
          })();
      </script>
  
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/avatar.png" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">Thought_Tiger</a></h1>
        </hgroup>

        

        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/tags/">标签云</a></li>
                        
                            <li><a href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa GitHub" target="_blank" href="/thoughttiger.github.com" title="GitHub"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/aws/">aws</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ceph/">ceph</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fuel/">fuel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github/">github</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/intellij/">intellij</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/maven/">maven</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openstack/">openstack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/s3/">s3</a></li></ul>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="https://hexo.io">Hexo</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="https://pages.github.com/">GitHub</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://moxfive.xyz/">MOxFIVE</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">专注于前端</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">Thought_Tiger</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/avatar.png" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">Thought_Tiger</a></h1>
            </hgroup>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/tags/">标签云</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa GitHub" target="_blank" href="/thoughttiger.github.com" title="GitHub"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我"/>
</nav>
      <div class="body-wrap"><article id="post-java_s3_api_simple" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/05/27/java_s3_api_simple/" class="article-date">
      <time datetime="2016-05-26T16:07:15.823Z" itemprop="datePublished">2016-05-27</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Java开发Amazon S3 API
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        

        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/s3/">s3</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="eclipse插件"><a href="#eclipse插件" class="headerlink" title="eclipse插件"></a>eclipse插件</h1><p><img src="http://i.imgur.com/Oa6XkV4.jpg" alt=""></p>
<a id="more"></a>
<p><img src="http://i.imgur.com/9nXDZhr.jpg" alt=""></p>
<p><img src="http://i.imgur.com/azLYiA3.jpg" alt=""></p>
<p><img src="http://i.imgur.com/erTdeMZ.jpg" alt=""></p>
<h1 id="代码与官方样例链接"><a href="#代码与官方样例链接" class="headerlink" title="代码与官方样例链接"></a>代码与官方样例链接</h1><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">http://docs.aws.amazon.com/zh_cn/AmazonS3/latest/dev/create-bucket-get-location-example.html 创建桶</span><br><span class="line">http://docs.aws.amazon.com/zh_cn/AmazonS3/latest/dev/delete-or-empty-bucket.html 删除桶</span><br><span class="line">http://docs.aws.amazon.com/zh_cn/AmazonS3/latest/dev/RetrievingObjectUsingJava.html 获取对象</span><br><span class="line">http://docs.aws.amazon.com/zh_cn/AmazonS3/latest/dev/UsingMPDotJavaAPI.html 上传对象</span><br><span class="line">http://docs.aws.amazon.com/zh_cn/AmazonS3/latest/dev/ListingObjectKeysUsingJava.html 列出对象</span><br><span class="line"></span><br><span class="line">http://docs.aws.amazon.com/AWSJavaSDK/latest/javadoc/  all API</span><br><span class="line">http://docs.ceph.com/docs/master/radosgw/s3/commons/  错误码</span><br></pre></td></tr></table></figure>
<p><strong>注意：客户端和服务端的时间相差只能在15分钟内（注意时区），否则会报403没有权限。</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">String endPoint = <span class="string">"http://172.16.0.2:6780"</span>;</span><br><span class="line">String accessKey = <span class="string">"Y8RC4X1HDY1Y7YVGPHZ2"</span>;</span><br><span class="line">String secretKey = <span class="string">"IHo5uLsGdtMPeUGedAt3ZOGE+FdbVzYc5XSXXj0t"</span>;</span><br><span class="line">AmazonS3 conn = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">String buckName = <span class="string">"mybuck1"</span>;</span><br><span class="line">Bucket bucket = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// System.setProperty(SDKGlobalConfiguration.ENABLE_S3_SIGV4_SYSTEM_PROPERTY,</span></span><br><span class="line">	<span class="comment">// "true");</span></span><br><span class="line">	AWSCredentials credentials = <span class="keyword">new</span> BasicAWSCredentials(accessKey, secretKey);</span><br><span class="line"></span><br><span class="line">	ClientConfiguration clientConfig = <span class="keyword">new</span> ClientConfiguration();</span><br><span class="line">	clientConfig.setProtocol(Protocol.HTTP);</span><br><span class="line"></span><br><span class="line">	conn = <span class="keyword">new</span> AmazonS3Client(credentials, clientConfig);</span><br><span class="line">	conn.setEndpoint(<span class="string">"http://172.16.0.2:6780"</span>);</span><br><span class="line">	<span class="comment">// conn.setRegion(Region.getRegion(Regions.US_EAST_1));</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 列出当前所有的桶</span><br><span class="line"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPrintAllBucket</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">	List&lt;Bucket&gt; buckets = conn.listBuckets();</span><br><span class="line">	<span class="keyword">for</span> (Bucket bucket : buckets) &#123;</span><br><span class="line">		String bucketLocation = conn.getBucketLocation(<span class="keyword">new</span> GetBucketLocationRequest(buckName));</span><br><span class="line">		System.out.println(bucket.getName() + <span class="string">"\t"</span> + StringUtils.fromDate(bucket.getCreationDate()));</span><br><span class="line">		System.out.println(<span class="string">"locations : "</span> + bucketLocation);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 创建桶</span><br><span class="line"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCreateBucket</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">	Bucket b = conn.createBucket(buckName);</span><br><span class="line">	assertNotNull(b);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 向桶导入对象</span><br><span class="line"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPutObjectToBucket</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">	ByteArrayInputStream input = <span class="keyword">new</span> ByteArrayInputStream(<span class="string">"Hello World!"</span>.getBytes());</span><br><span class="line">	conn.putObject(buckName, <span class="string">"hello.txt"</span>, input, <span class="keyword">new</span> ObjectMetadata());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 向桶导入对象</span><br><span class="line"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPutObjectToBucketUsingFile</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">	File file = <span class="keyword">new</span> File(<span class="string">"hello2.txt"</span>);</span><br><span class="line">	conn.putObject(<span class="keyword">new</span> PutObjectRequest(buckName, <span class="string">"hl3"</span>, file).withCannedAcl(CannedAccessControlList.PublicRead));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 列出对象信息</span><br><span class="line"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPrintAllObjectInBucket</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">	ObjectListing objects = conn.listObjects(buckName);</span><br><span class="line">	do &#123;</span><br><span class="line">		<span class="keyword">for</span> (S3ObjectSummary objectSummary : objects.getObjectSummaries()) &#123;</span><br><span class="line">			System.out.println(objectSummary.getKey() + <span class="string">"\t"</span> + objectSummary.getSize() + <span class="string">"\t"</span></span><br><span class="line">					+ StringUtils.fromDate(objectSummary.getLastModified()));</span><br><span class="line">		&#125;</span><br><span class="line">		objects = conn.listNextBatchOfObjects(objects);</span><br><span class="line">	&#125; <span class="keyword">while</span> (objects.isTruncated());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 删除对象</span><br><span class="line"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDeleteObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">	conn.deleteObject(buckName, <span class="string">"goodbye.txt"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 对对象设置访问权限</span><br><span class="line"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testChangePriToObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">	conn.setBucketAcl(buckName, CannedAccessControlList.PublicReadWrite);</span><br><span class="line">	conn.setObjectAcl(buckName, <span class="string">"hl3"</span>, CannedAccessControlList.AuthenticatedRead);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 将对象下载为文件</span><br><span class="line"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFromObjectToFile</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">	GetObjectRequest srcObjectRequest = <span class="keyword">new</span> GetObjectRequest(buckName, <span class="string">"hello.txt"</span>);</span><br><span class="line">	File desFile = <span class="keyword">new</span> File(<span class="string">"C:\\hello.txt"</span>);</span><br><span class="line">	conn.getObject(srcObjectRequest, desFile);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 产生对象下载的signed URL地址</span><br><span class="line"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGenObjDldUrl</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">	GeneratePresignedUrlRequest request = <span class="keyword">new</span> GeneratePresignedUrlRequest(buckName, <span class="string">"hl3"</span>);</span><br><span class="line">	System.out.println(conn.generatePresignedUrl(request));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// System.setProperty(SDKGlobalConfiguration.ENABLE_S3_SIGV4_SYSTEM_PROPERTY,</span></span><br><span class="line">	<span class="comment">// "true");</span></span><br><span class="line"></span><br><span class="line">	String accessKey = <span class="string">"Y8RC4X1HDY1Y7YVGPHZ2"</span>;</span><br><span class="line">	String secretKey = <span class="string">"IHo5uLsGdtMPeUGedAt3ZOGE+FdbVzYc5XSXXj0t"</span>;</span><br><span class="line"></span><br><span class="line">	AWSCredentials credentials = <span class="keyword">new</span> BasicAWSCredentials(accessKey, secretKey);</span><br><span class="line"></span><br><span class="line">	ClientConfiguration clientConfig = <span class="keyword">new</span> ClientConfiguration();</span><br><span class="line">	clientConfig.setProtocol(Protocol.HTTP);</span><br><span class="line"></span><br><span class="line">	AmazonS3 conn = <span class="keyword">new</span> AmazonS3Client(credentials, clientConfig);</span><br><span class="line">	conn.setEndpoint(<span class="string">"http://172.16.0.2:6780"</span>);</span><br><span class="line"></span><br><span class="line">	conn.createBucket(<span class="string">"my-new-bucket-2"</span>);</span><br><span class="line"></span><br><span class="line">	List&lt;Bucket&gt; buckets = conn.listBuckets();</span><br><span class="line">	<span class="keyword">for</span> (Bucket bucket : buckets) &#123;</span><br><span class="line">		System.out.println(bucket.getName() + <span class="string">"\t"</span> + StringUtils.fromDate(bucket.getCreationDate()));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="http://i.imgur.com/VAYcqin.jpg" alt=""></p>
<h1 id="务必确保客户端和S3服务端时间在15分钟内，否则报403没有权限"><a href="#务必确保客户端和S3服务端时间在15分钟内，否则报403没有权限" class="headerlink" title="务必确保客户端和S3服务端时间在15分钟内，否则报403没有权限"></a>务必确保客户端和S3服务端时间在15分钟内，否则报403没有权限</h1><p><img src="http://i.imgur.com/JOX0z6K.jpg" alt=""></p>
<h1 id="aws-sdk-java在Ceph-S3上的局限性"><a href="#aws-sdk-java在Ceph-S3上的局限性" class="headerlink" title="aws-sdk-java在Ceph S3上的局限性"></a>aws-sdk-java在Ceph S3上的局限性</h1><p>如果使用Ceph提供的S3接口，则有使用局限性：<br>实践下来表明：<br>1、不支持V4版本的鉴权，不知道后面优化没有<br>System.setProperty(SDKGlobalConfiguration.ENABLE_S3_SIGV4_SYSTEM_PROPERTY,<br>         “true”);</p>
<h1 id="在Amazon官网申请的账号，通过其他客户端操作S3"><a href="#在Amazon官网申请的账号，通过其他客户端操作S3" class="headerlink" title="在Amazon官网申请的账号，通过其他客户端操作S3"></a>在Amazon官网申请的账号，通过其他客户端操作S3</h1><p><a href="http://s3browser.com/" target="_blank" rel="external">http://s3browser.com/</a></p>
<p><a href="https://console.aws.amazon.com/iam/home?#security_credential" target="_blank" rel="external">https://console.aws.amazon.com/iam/home?#security_credential</a></p>
<p><img src="http://i.imgur.com/1YwvcMC.jpg" alt=""></p>
<p>然后下载S3 Browser：<br><img src="http://i.imgur.com/YurwzE2.jpg" alt=""></p>
<p>Amazon offers Simple Storage Service (S3) to provide storage through web interfaces such as REST. Ceph extends its compatibility with S3 through RESTful API. S3 client applications can access the Ceph object storage based on access and secret keys. Let’s now see how to configure this. Perform the following commands on the ceph-rgw node until otherwise specified:</p>
<p>Radosgw users should have enough capabilities to allow S3 requests. Add the required capabilities to the radosgw user ID (mona):<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># radosgw-admin caps add --uid=mona  --caps="users=*"</span></span><br><span class="line"><span class="comment"># radosgw-admin caps add --uid=mona  --caps="buckets=*"</span></span><br><span class="line"><span class="comment"># radosgw-admin caps add --uid=mona  --caps="metadata=*"</span></span><br><span class="line">radosgw-admin caps add --uid=mona --caps=<span class="string">"zone=*"</span></span><br></pre></td></tr></table></figure></p>
<p>S3 API-compatible Ceph object storage</p>

      
    </div>
    
  </div>
  
    


    <nav id="article-nav">
        
            <div id="article-nav-newer" class="article-nav-title">
                <a href="/2016/05/28/learn_s3_1/">
                    Amazon AWS抓包学习S3： 1、代码原型
                </a>
            </div>
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/2016/05/27/ceph_radosgw_common_usages/">
                    ceph radosgw的常用方式
                </a>
            </div>
        
    </nav>

  
</article>

    <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#eclipse插件"><span class="toc-number">1.</span> <span class="toc-text">eclipse插件</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#代码与官方样例链接"><span class="toc-number">2.</span> <span class="toc-text">代码与官方样例链接</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#务必确保客户端和S3服务端时间在15分钟内，否则报403没有权限"><span class="toc-number">3.</span> <span class="toc-text">务必确保客户端和S3服务端时间在15分钟内，否则报403没有权限</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#aws-sdk-java在Ceph-S3上的局限性"><span class="toc-number">4.</span> <span class="toc-text">aws-sdk-java在Ceph S3上的局限性</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#在Amazon官网申请的账号，通过其他客户端操作S3"><span class="toc-number">5.</span> <span class="toc-text">在Amazon官网申请的账号，通过其他客户端操作S3</span></a></li></ol>
</div>
<style>
    .left-col .switch-btn {
        display: none;
    }
    .left-col .switch-area {
        display: none;
    }
</style>

<input type="button" id="tocButton" value="隐藏目录"  title="点击按钮隐藏或者显示文章目录">
<script>
    var valueHide = "隐藏目录";
    var valueShow = "显示目录";

    if ($(".left-col").is(":hidden")) {
        $("#tocButton").attr("value", valueShow);
    }

    $("#tocButton").click(function() {
        if ($("#toc").is(":hidden")) {
            $("#tocButton").attr("value", valueHide);
            $("#toc").slideDown(320);
            $(".switch-btn, .switch-area").fadeOut(300);
        }
        else {
            $("#tocButton").attr("value", valueShow);
            $("#toc").slideUp(350);
            $(".switch-btn, .switch-area").fadeIn(500);
        }
    })

    if ($(".toc").length < 1) {
        $("#toc, #tocButton").hide();
        $(".switch-btn, .switch-area").show();
    }
</script>





    
<div class="share">
    
        <div class="bdsharebuttonbox">
            <a href="#" class="fa fa-twitter bds_twi" data-cmd="twi" title="分享到推特"></a>
            <a href="#" class="fa fa-weibo bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
            <a href="#" class="fa fa-qq bds_sqq" data-cmd="sqq" title="分享给 QQ 好友"></a>
            <a href="#" class="fa fa-files-o bds_copy" data-cmd="copy" title="复制网址"></a>
            <a href="#" class="fa fa fa-envelope-o bds_mail" data-cmd="mail" title="通过邮件分享"></a>
            <a href="#" class="fa fa-weixin bds_weixin" data-cmd="weixin" title="生成文章二维码"></a>
            <a href="#" class="fa fa-share-alt bds_more" data-cmd="more"></i></a>
        </div>
        <script>
            window._bd_share_config={
                "common":{"bdSnsKey":{},"bdText":"Java开发Amazon S3 API　| Thought_Tiger`s Blogs　","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
        </script>
    

    
</div>







    
      <div class="duoshuo" id="comments">
    <!-- 多说评论框 start -->
    <div class="ds-thread" data-thread-key="2016/05/27/java_s3_api_simple/" data-title="Java开发Amazon S3 API" data-url="http://thoughttiger.github.com/2016/05/27/java_s3_api_simple/"></div>
    <!-- 多说评论框 end -->
    <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
    <script type="text/javascript">
    var duoshuoQuery = {short_name:"thoughttiger"};
    (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] 
         || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
    </script>
    <!-- 多说公共JS代码 end -->
</div>

    




    <div class="scroll" id="post-nav-button">
        
            <a href="/2016/05/28/learn_s3_1/" title="上一篇: Amazon AWS抓包学习S3： 1、代码原型">
                <i class="fa fa-angle-left"></i>
            </a>
        

        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/2016/05/27/ceph_radosgw_common_usages/" title="下一篇: ceph radosgw的常用方式">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/05/29/github_trouble_shooting_with_proxy/">翻墙访问github</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/28/learn_s3_2/">Amazon AWS抓包学习S3： 2、创建桶抓包分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/28/learn_s3_1/">Amazon AWS抓包学习S3： 1、代码原型</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/27/java_s3_api_simple/">Java开发Amazon S3 API</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/27/ceph_radosgw_common_usages/">ceph radosgw的常用方式</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/26/deploy_openstack_using_fuel6.0/">使用Fuel6.0在VMWare Workstation上安装OpenStack</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/26/fuel_ceph_s3_default_service_port/">Fuel6.0搭建好ceph环境，S3默认端口是6780，而不是80</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/26/maven_pack_without_unit_test/">Maven：打包时不执行单元测试</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/26/maven_pack_to_one_exec_jar/">Maven：将所有依赖打包到一个可执行的jar中</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/25/how_to_crack_intellij_15.0.1/">怎样获得IntelliJ 15.0.1 Pro版</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/22/to-build-your-blogs-system-using-hexo/">git+github+hexo+MarkdownPad创建自己博客系统</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/21/hello-world/">Hello World</a></li></ul>




    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2016 Thought_Tiger
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题  v3.0">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" >本站到访数: 
                            <span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>, </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit">本页阅读量: 
                            <span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    
<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.1.22/require.min.js"></script>




<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>